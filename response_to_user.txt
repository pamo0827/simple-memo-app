エラーログをご提供いただきありがとうございます。
`SyntaxError: Bad control character in string literal in JSON` というエラーは、AIが生成したテキストにJSONとして正しくない文字（不正な改行など）が含まれているために、JSONの解析に失敗していることを示しています。

これは、AIが必ずしも指示通りに完璧なJSON形式の文字列だけを返すとは限らないために発生します。

**対策として、AIからの応答をより堅牢に処理するように `lib/ai.ts` を修正しました。**

具体的には、AIが返したテキスト全体から、JSONオブジェクトと思われる部分 (`{...}`) を正規表現で正確に抜き出し、その部分だけを解析するように変更しました。これにより、AIがJSONの前後に説明文などを付け加えても、エラーが発生しにくくなります。

この修正により、「Failed to process text.」や「AI returned an invalid format.」といったエラーの発生が大幅に減少することが期待されます。

お手数ですが、再度お試しいただき、問題が解消されるかご確認いただけますでしょうか。